<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üéæ BALL SURVIVAL PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0a0e27, #1a1a3e);
    overflow: hidden;
    font-family: 'Arial Black', sans-serif;
  }

  canvas {
    display: block;
    background: radial-gradient(ellipse at center, #1a2a4a 0%, #0a0e27 100%);
  }

  #hud {
    position: fixed;
    top: 20px;
    left: 20px;
    color: #00f2ff;
    font-size: 18px;
    text-shadow: 0 0 10px #00f2ff;
    z-index: 10;
    font-weight: bold;
    line-height: 1.8;
  }

  #hud .label {
    color: #aaa;
    font-size: 12px;
    text-transform: uppercase;
  }

  #caption {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    font-weight: bold;
    color: #ff00ff;
    text-shadow: 0 0 20px #ff00ff;
    z-index: 20;
    opacity: 0;
    transition: opacity 0.3s;
    text-align: center;
    pointer-events: none;
  }

  #gameOver {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: none;
    z-index: 100;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
  }

  #gameOver h1 {
    font-size: 3rem;
    margin-bottom: 20px;
    color: #ff00ff;
    text-shadow: 0 0 30px #ff00ff;
  }

  #gameOver .stats {
    font-size: 1.2rem;
    margin: 15px 0;
  }

  #gameOver .stats span {
    color: #00f2ff;
    font-weight: bold;
  }

  #gameOver button {
    margin-top: 30px;
    padding: 15px 40px;
    font-size: 1.2rem;
    background: linear-gradient(135deg, #00f2ff, #ff00ff);
    border: none;
    color: black;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 20px #00f2ff;
  }

  #gameOver button:hover {
    transform: scale(1.1);
  }

  #controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: #aaa;
    font-size: 0.9rem;
    text-align: center;
  }
</style>
</head>

<body>

<div id="hud">
  <div><span class="label">Score</span><br><span id="score">0</span></div>
  <div style="margin-top: 15px;"><span class="label">Combo</span><br><span id="combo">0x</span></div>
  <div style="margin-top: 15px;"><span class="label">Speed</span><br><span id="speed">1.0x</span></div>
</div>

<div id="caption">+100 COMBO!</div>

<div id="gameOver">
  <h1>GAME OVER!</h1>
  <div class="stats">Final Score: <span id="finalScore">0</span></div>
  <div class="stats">Time Survived: <span id="timeScore">0</span>s</div>
  <div class="stats">Max Combo: <span id="maxCombo">0x</span></div>
  <button onclick="location.reload()">PLAY AGAIN</button>
  <button onclick="window.location.href='../'">BACK TO HUB</button>
</div>

<div id="controls">‚¨ÜÔ∏è / ‚¨áÔ∏è / ‚¨ÖÔ∏è / ‚û°Ô∏è to move | SPACE to jump</div>

<canvas id="game"></canvas>

<script>
/* -------------------- CANVAS & AUDIO SETUP -------------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let audioCtx;

function initAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

function playSound(freq, type, duration, volume = 0.3) {
  initAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type;
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gain.gain.setValueAtTime(volume, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* -------------------- GAME STATE -------------------- */
let ball, obstacles, speed, alive, score = 0, combo = 0, maxCombo = 0, startTime = 0;

/* -------------------- INPUT HANDLING -------------------- */
const keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false, ' ': false };
window.addEventListener('keydown', (e) => { if (e.key in keys) { keys[e.key] = true; e.preventDefault(); } });
window.addEventListener('keyup', (e) => { if (e.key in keys) { keys[e.key] = false; } });

function resetGame() {
  score = 0;
  combo = 0;
  maxCombo = 0;
  startTime = Date.now();
  
  ball = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    r: 12,
    dx: 0,
    dy: 0,
    color: randomColor(),
    jumps: 0,
    maxJumps: 2
  };

  obstacles = [];
  speed = 1;
  alive = true;

  for (let i = 0; i < 6; i++) {
    obstacles.push({
      angle: Math.random() * Math.PI * 2,
      radius: 100 + i * 50,
      width: 16,
      speed: (Math.random() > 0.5 ? 1 : -1) * (0.01 + Math.random() * 0.025)
    });
  }

  playSound(440, 'sine', 0.1);
}

resetGame();

/* -------------------- COLORS & EFFECTS -------------------- */
function randomColor() {
  const colors = ["#ff3b3b", "#3bffef", "#ffd93b", "#b83bff", "#ff69b4"];
  return colors[Math.floor(Math.random() * colors.length)];
}

let particles = [];

function addParticles(x, y, color, count = 8) {
  for (let i = 0; i < count; i++) {
    particles.push({
      x, y,
      vx: (Math.random() - 0.5) * 8,
      vy: (Math.random() - 0.5) * 8,
      life: 0.8,
      color
    });
  }
}

/* -------------------- GAME LOOP -------------------- */
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!alive) {
    ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    document.getElementById("gameOver").style.display = "flex";
    return;
  }

  // CONTROLS
  if (keys.ArrowLeft) ball.dx = -6;
  if (keys.ArrowRight) ball.dx = 6;
  if (!keys.ArrowLeft && !keys.ArrowRight) ball.dx *= 0.8;
  
  if (keys[' '] && ball.jumps < ball.maxJumps) {
    ball.dy = -10;
    ball.jumps++;
    playSound(600, 'sine', 0.1);
  }

  // MOVEMENT
  ball.x += ball.dx * speed;
  ball.y += ball.dy * speed;
  ball.dy += 0.25;

  // WALLS
  if (ball.x < ball.r) ball.x = ball.r;
  if (ball.x > canvas.width - ball.r) ball.x = canvas.width - ball.r;
  if (ball.y < ball.r) ball.y = ball.r;

  // GROUND
  if (ball.y > canvas.height - 40) {
    ball.y = canvas.height - 40;
    ball.dy = 0;
    ball.jumps = 0;
  }

  // DRAW BALL
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fillStyle = ball.color;
  ctx.fill();
  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 2;
  ctx.stroke();

  // OBSTACLES
  ctx.strokeStyle = "#00f2ff";
  ctx.lineWidth = 3;
  ctx.shadowColor = "rgba(0, 242, 255, 0.5)";
  ctx.shadowBlur = 15;

  obstacles.forEach(o => {
    o.angle += o.speed * speed * 0.02;

    const ox = canvas.width / 2 + Math.cos(o.angle) * o.radius;
    const oy = canvas.height / 2 + Math.sin(o.angle) * o.radius;

    ctx.beginPath();
    ctx.arc(ox, oy, o.width, 0, Math.PI * 2);
    ctx.stroke();

    const dist = Math.hypot(ball.x - ox, ball.y - oy);
    if (dist < ball.r + o.width && alive) {
      alive = false;
      playSound(200, 'sine', 0.3);
      addParticles(ball.x, ball.y, ball.color, 15);
    }
  });

  ctx.shadowBlur = 0;

  // PARTICLES
  particles = particles.filter(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.2;
    p.life -= 0.02;
    
    ctx.fillStyle = p.color + Math.round(p.life * 255).toString(16).padStart(2, '0');
    ctx.beginPath();
    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
    ctx.fill();
    
    return p.life > 0;
  });

  // SCORE
  score += Math.floor(speed);
  combo++;
  maxCombo = Math.max(maxCombo, combo);
  
  if (combo % 100 === 0 && combo > 0) {
    showCaption(`+${combo} COMBO!`);
    playSound(800, 'sine', 0.15);
    addParticles(canvas.width / 2, 100, "#ffff00", 10);
  }

  // UPDATE HUD
  document.getElementById("score").textContent = score;
  document.getElementById("combo").textContent = combo + "x";
  document.getElementById("speed").textContent = speed.toFixed(2) + "x";

  // BOTTOM FAIL
  if (ball.y > canvas.height + 50) {
    alive = false;
    playSound(150, 'sine', 0.3);
  }

  // DIFFICULTY
  speed += 0.0003;

  requestAnimationFrame(update);
}

function showCaption(text) {
  const cap = document.getElementById("caption");
  cap.textContent = text;
  cap.style.opacity = 1;
  setTimeout(() => cap.style.opacity = 0, 800);
}

update();

// Final score display
document.addEventListener('DOMContentLoaded', () => {
  const observer = new MutationObserver(() => {
    if (document.getElementById("gameOver").style.display === "flex") {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      document.getElementById("finalScore").textContent = score;
      document.getElementById("timeScore").textContent = elapsed;
      document.getElementById("maxCombo").textContent = maxCombo + "x";
      observer.disconnect();
    }
  });
  observer.observe(document.getElementById("gameOver"), { attributes: true });
});

</script>

</body>
</html>
