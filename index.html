<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>100 COUNTRY PRO LOOP</title>
<style>
:root { --neon:#00f2ff; --gold:#ffcc00; }
body {
  margin:0; background:#020205; overflow:hidden;
  display:flex; justify-content:center; align-items:center;
  font-family:Segoe UI, sans-serif;
}
#stream {
  width:100vw; height:177.77vw;
  max-width:56.25vh; max-height:100vh;
  position:relative; background:black;
}
canvas { width:100%; height:100%; display:block; }
#winner {
  position:absolute; inset:0;
  display:none; align-items:center; justify-content:center;
  flex-direction:column;
  background:rgba(0,0,0,.9); z-index:20;
}
#winner img {
  width:220px; height:220px;
  border-radius:50%; border:8px solid white;
}
#winner h1 { color:var(--gold); font-size: 3rem; }
.live {
  position:absolute; top:20px; left:20px;
  background:red; padding:8px 14px;
  font-weight:900; color:white; border-radius: 4px;
}
#startOverlay {
  position: absolute; inset: 0; background: rgba(0,0,0,0.8);
  z-index: 100; display: flex; justify-content: center; align-items: center;
}
#startBtn {
  padding: 20px 40px; font-size: 24px; background: #28a745;
  color: white; border: none; border-radius: 50px; font-weight: bold;
}
</style>
</head>
<body>

<div id="startOverlay">
    <button id="startBtn">TAP TO START STREAM</button>
</div>

<div id="stream">
  <div class="live">LIVE</div>
  <canvas id="c" width="1080" height="1920"></canvas>
  <div id="winner">
    <img id="winnerImg">
    <h1 id="winnerName"></h1>
  </div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const CENTER = { x:540, y:960 };
const RADIUS = 500;
const BALL_R = 25; // Slightly larger for mobile visibility
const TOTAL = 100;

let balls = [];
let running = false;
let slowMo = 1;
let announced3 = false;
let startTime = 0;
let audioCtx;

const arena = { gapStart:-0.25, gapEnd:0.25 };

function bloop() {
  if(!audioCtx) return;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.frequency.value=500;
  o.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+.08);
  g.gain.value=.1;
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.1);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.1);
}

function elimSound() {
  if(!audioCtx) return;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.frequency.value=180;
  o.frequency.exponentialRampToValueAtTime(60,audioCtx.currentTime+.25);
  g.gain.value=.2;
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.3);
}

function say(t){
  if(!running && !t.includes("winner")) return;
  speechSynthesis.cancel();
  speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

const codes=["us","in","br","gb","fr","de","jp","cn","ru","it","es","mx","kr","ca","au"];
const flags=[];
for(let i=0;i<codes.length;i++){
  const img=new Image();
  img.crossOrigin = "anonymous";
  img.src=`https://flagcdn.com/w160/${codes[i]}.png`;
  flags.push({name:codes[i].toUpperCase(), img});
}

class Ball {
  constructor(item){
    const a=Math.random() * Math.PI * 2;
    const r=Math.random() * (RADIUS-60);
    this.x=CENTER.x+Math.cos(a)*r;
    this.y=CENTER.y+Math.sin(a)*r;
    this.vx=(Math.random()-.5)*12;
    this.vy=(Math.random()-.5)*12;
    this.r=BALL_R;
    this.item=item;
    this.out=false;
  }

  update(){
    const dx=this.x-CENTER.x;
    const dy=this.y-CENTER.y;
    const d=Math.hypot(dx,dy)||1;
    this.vx+=(-dy/d)*0.05;
    this.vy+=( dx/d)*0.05;
    this.x+=this.vx*slowMo;
    this.y+=this.vy*slowMo;

    if(d>RADIUS-this.r){
      const ang=Math.atan2(dy,dx);
      if(ang>arena.gapStart && ang<arena.gapEnd){
        this.out=true;
        elimSound();
      } else {
        const nx=dx/d, ny=dy/d;
        const dot = (this.vx * nx) + (this.vy * ny);
        this.vx -= 2 * dot * nx;
        this.vy -= 2 * dot * ny;
        this.x=CENTER.x+nx*(RADIUS-this.r-1);
        this.y=CENTER.y+ny*(RADIUS-this.r-1);
        bloop();
      }
    }
  }

  draw(){
    ctx.save();
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.clip();
    if(this.item.img.complete) {
        ctx.drawImage(this.item.img,this.x-this.radius||this.x-this.r,this.y-this.r,this.r*2,this.r*2);
    } else {
        ctx.fillStyle="white"; ctx.fill();
    }
    ctx.restore();
  }
}

function collide(){
  for(let i=0;i<balls.length;i++){
    for(let j=i+1;j<balls.length;j++){
      const a=balls[i], b=balls[j];
      const dx=b.x-a.x, dy=b.y-a.y;
      const d=Math.hypot(dx,dy);
      const min=a.r+b.r;
      if(d<min && d>0){
        const nx=dx/d, ny=dy/d;
        const overlap=min-d;
        a.x-=nx*overlap*0.5; a.y-=ny*overlap*0.5;
        b.x+=nx*overlap*0.5; b.y+=ny*overlap*0.5;
        const dvx=b.vx-a.vx, dvy=b.vy-a.vy;
        const impact = (dvx*nx) + (dvy*ny);
        if(impact>0)continue;
        a.vx+=impact*nx; a.vy+=impact*ny;
        b.vx-=impact*nx; b.vy-=impact*ny;
        bloop();
      }
    }
  }
}

function start(){
  balls=[];
  announced3=false;
  slowMo=1;
  arena.gapStart=-0.25;
  arena.gapEnd=0.25;
  startTime=performance.now();
  running=true;
  for(let i=0;i<TOTAL;i++) balls.push(new Ball(flags[i%flags.length]));
  say("The race begins");
}

function win(ball){
  running=false;
  document.getElementById("winnerImg").src=ball.item.img.src;
  document.getElementById("winnerName").textContent=ball.item.name+" WINS";
  document.getElementById("winner").style.display="flex";
  say(ball.item.name + " is the winner");
  setTimeout(()=>{
    document.getElementById("winner").style.display="none";
    start();
  },5000);
}

function loop(t){
  ctx.clearRect(0,0,1080,1920);
  if(running){
    if(t-startTime>15000){
      arena.gapStart-=0.0015;
      arena.gapEnd+=0.0015;
    }
    balls.forEach(b=>b.update());
    collide();
    balls=balls.filter(b=>!b.out);
    if(balls.length===3 && !announced3){
      announced3=true;
      slowMo=0.4;
      say("Only three remain");
    }
    if(balls.length===1) win(balls[0]);
  }
  
  ctx.strokeStyle="#00f2ff";
  ctx.lineWidth=20;
  ctx.beginPath();
  ctx.arc(CENTER.x,CENTER.y,RADIUS,arena.gapEnd,arena.gapStart);
  ctx.stroke();
  
  balls.forEach(b=>b.draw());
  requestAnimationFrame(loop);
}

document.getElementById("startBtn").onclick = () => {
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    document.getElementById("startOverlay").style.display = "none";
    start();
};

requestAnimationFrame(loop);
</script>
</body>
</html>
