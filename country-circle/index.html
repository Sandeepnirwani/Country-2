<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COUNTRY SPEED BATTLE</title>
    <style>
        :root { --gold:#ffcc00; --red:#ff3131; --dark-blue:#102a43; --dark:#000; }
        * { box-sizing: border-box; }
        body {
            margin:0; background:#000; overflow:hidden;
            display:flex; justify-content:center; align-items:center;
            font-family:'Arial Black', sans-serif; height: 100vh;
        }
        #stream {
            width:100vw; height:177.77vw;
            max-width:56.25vh; max-height:100vh;
            position:relative; overflow:hidden;
            background: var(--dark-blue); /* DEEP DARK BLUE */
        }
        canvas { width:100%; height:100%; display:block; }
        
        .live {
            position:absolute; top:20px; left:20px;
            background:var(--red); padding:6px 12px;
            font-weight:900; color:white; border-radius: 4px; z-index: 10;
            font-size: 12px;
        }

        #scorecard { 
            position:absolute; top:20px; right:20px; 
            background:rgba(0,0,0,0.6); color:white; 
            padding:10px 15px; border-radius:8px; z-index:15; 
            border: 1px solid rgba(255,255,255,0.2); text-align: right;
        }

        /* COMPACT WINNER CARD */
        #topWinner {
            position: absolute;
            top: 80px; left: 50%;
            transform: translateX(-50%);
            display: flex; align-items: center; gap: 12px;
            z-index: 5; background: rgba(0,0,0,0.8);
            padding: 8px 15px; border-radius: 40px;
            border: 2px solid var(--gold);
            min-width: 160px;
        }
        #topWinner img {
            width: 45px; height: 45px;
            border-radius: 50%; border: 2px solid #fff;
            object-fit: cover;
        }
        #topWinner .info { display: flex; flex-direction: column; }
        #topWinner .title { font-size: 8px; color: var(--gold); letter-spacing: 1px; }
        #topWinner .name { font-size: 16px; color: white; }

        #commentary { 
            position:absolute; left:50%; top:45%; transform:translate(-50%, -50%); 
            width: 90%; text-align: center; color: white; font-size:60px; font-weight: 900;
            z-index:20; opacity:0; transition: 0.2s; pointer-events: none;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }

        #ticker { 
            position:absolute; bottom:0; width:100%; height:60px; 
            background:var(--dark); display:flex; align-items:center; overflow:hidden; z-index:14;
        }
        #tickerInner { display:flex; gap:35px; white-space:nowrap; animation: scrollTicker 70s linear infinite; }
        @keyframes scrollTicker { 0% { transform: translateX(0); } 100% { transform: translateX(-33.33%); } }
        .tick { display:flex; align-items:center; gap:10px; color:white; font-size: 14px; font-weight: 700; }
        .tick img { width:40px; height:26px; border-radius:2px; }

        /* WINNER OVERLAY - SMALLER SCALE */
        #winnerOverlay {
            position:absolute; inset:0; display:none; 
            align-items:center; justify-content:center; flex-direction:column;
            background:rgba(0,0,0,0.9); z-index:100;
        }
        #winnerOverlay img { width:200px; height:200px; border-radius:50%; border:8px solid var(--gold); }
        #winnerOverlay h1 { color:var(--gold); font-size:3.5rem; margin-top:15px; text-align:center; }
    </style>
</head>
<body>

<div id="stream">
    <div class="live">‚óè LIVE</div>
    
    <div id="scorecard">
        <div style="font-size:10px; opacity:0.7">REMAINING</div>
        <div id="remaining" style="font-size:32px; font-weight:900">0</div>
    </div>

    <div id="topWinner" style="display: none;">
        <img id="lastWinnerImg" src="">
        <div class="info">
            <div class="title">LAST WINNER</div>
            <div class="name" id="lastWinnerName">---</div>
        </div>
    </div>
    
    <div id="commentary"></div>
    <canvas id="c" width="1080" height="1920"></canvas>
    <div id="ticker"><div id="tickerInner"></div></div>
    
    <div id="winnerOverlay">
        <h2 style="color:white; letter-spacing:5px; font-size: 18px;">üèÜ CHAMPION üèÜ</h2>
        <img id="champImg" src="">
        <h1 id="champName"></h1>
    </div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d", { alpha: false });
const CENTER = { x: 540, y: 1080 }, RADIUS = 460, BALL_R = 38, TOTAL = 60;
const GAP_ANGLE = 0.55; 

let balls = [], arenaRotation = 0, state = "IDLE";

const countries = [
    {c:'us', n:'USA'},{c:'in', n:'INDIA'},{c:'br', n:'BRAZIL'},{c:'gb', n:'UK'},
    {c:'fr', n:'FRANCE'},{c:'de', n:'GERMANY'},{c:'jp', n:'JAPAN'},{c:'cn', n:'CHINA'},
    {c:'ru', n:'RUSSIA'},{c:'it', n:'ITALY'},{c:'es', n:'SPAIN'},{c:'mx', n:'MEXICO'},
    {c:'ca', n:'CANADA'},{c:'au', n:'AUSTRALIA'},{c:'id', n:'INDONESIA'},{c:'kr', n:'KOREA'}
];

const flagPool = [];
for(let i=0; i<TOTAL; i++) {
    const d = countries[i % countries.length];
    const img = new Image();
    img.src = `https://flagcdn.com/w160/${d.c}.png`;
    flagPool.push({ name: d.n, img, code: d.c });
}

const ticker = document.getElementById('tickerInner');
[...flagPool, ...flagPool].forEach(f => {
    const d = document.createElement('div');
    d.className = 'tick';
    d.innerHTML = `<img src="${f.img.src}"> <span>${f.name}</span>`;
    ticker.appendChild(d);
});

function say(t) {
    const el = document.getElementById('commentary');
    el.textContent = t; el.style.opacity = 1;
    setTimeout(() => el.style.opacity = 0, 2000);
    const u = new SpeechSynthesisUtterance(t);
    u.rate = 1.3; window.speechSynthesis.speak(u);
}

class Ball {
    constructor(meta, i) {
        this.meta = meta;
        this.x = CENTER.x + (Math.random()-0.5)*300;
        this.y = -100 - (i * 70);
        this.vx = (Math.random()-0.5)*12;
        this.vy = 0;
        this.out = false;
    }

    update() {
        if (state === "FILL" || state === "JUGGLE") {
            this.vy += 0.8; this.vx *= 0.98;
            this.x += this.vx; this.y += this.vy;
            this.collide(0.4);
        } else if (state === "BATTLE") {
            this.x += this.vx; this.y += this.vy;
            this.collide(1.0);
        }

        for(let o of balls) {
            if(o === this || o.out) continue;
            const dx = o.x-this.x, dy = o.y-this.y, dist = Math.hypot(dx,dy);
            if(dist < BALL_R*2) {
                const nx = dx/dist, ny = dy/dist, overlap = BALL_R*2-dist;
                this.x -= nx*overlap*0.5; this.y -= ny*overlap*0.5;
                o.x += nx*overlap*0.5; o.y += ny*overlap*0.5;
            }
        }
    }

    collide(e) {
        const dx = this.x-CENTER.x, dy = this.y-CENTER.y, d = Math.hypot(dx,dy);
        if(d > RADIUS - BALL_R) {
            let ang = Math.atan2(dy, dx) - arenaRotation;
            while(ang < -Math.PI) ang += Math.PI*2;
            while(ang > Math.PI) ang -= Math.PI*2;
            if(state === "BATTLE" && Math.abs(ang) < GAP_ANGLE) {
                this.out = true; return;
            }
            const nx = dx/d, ny = dy/d, dot = this.vx*nx + this.vy*ny;
            this.vx = (this.vx - 2*dot*nx)*e;
            this.vy = (this.vy - 2*dot*ny)*e;
            this.x = CENTER.x + nx*(RADIUS-BALL_R);
            this.y = CENTER.y + ny*(RADIUS-BALL_R);
        }
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.beginPath(); ctx.arc(0,0,BALL_R,0,Math.PI*2); ctx.clip();
        ctx.drawImage(this.meta.img, -BALL_R, -BALL_R, BALL_R*2, BALL_R*2);
        ctx.restore();
    }
}

async function startLoop() {
    state = "FILL"; balls = [];
    document.getElementById("winnerOverlay").style.display = "none";
    for(let i=0; i<TOTAL; i++) {
        balls.push(new Ball(flagPool[i], i));
        document.getElementById('remaining').textContent = balls.length;
        await new Promise(r => setTimeout(r, 40));
    }
    state = "JUGGLE"; await new Promise(r => setTimeout(r, 1200));
    say("START!"); state = "BATTLE";
    balls.forEach(b => { b.vx = (Math.random()-0.5)*35; b.vy = (Math.random()-0.5)*35; });
}

function render() {
    ctx.fillStyle = "#102a43"; 
    ctx.fillRect(0,0,1080,1920);

    if(state === "BATTLE") {
        arenaRotation += 0.035;
        balls = balls.filter(b => !b.out);
        document.getElementById('remaining').textContent = balls.length;
        if(balls.length === 1) {
            state = "IDLE";
            const w = balls[0].meta;
            document.getElementById("champImg").src = w.img.src;
            document.getElementById("champName").textContent = w.name;
            document.getElementById("winnerOverlay").style.display = "flex";
            document.getElementById("topWinner").style.display = "flex";
            document.getElementById("lastWinnerImg").src = w.img.src;
            document.getElementById("lastWinnerName").textContent = w.name;
            say(w.name + " WINS!");
            setTimeout(startLoop, 6000);
        }
    }

    // Black Arena Ring
    ctx.save();
    ctx.translate(CENTER.x, CENTER.y);
    ctx.rotate(arenaRotation);
    ctx.strokeStyle = "#000"; ctx.lineWidth = 25; ctx.lineCap = "round";
    ctx.beginPath(); ctx.arc(0,0,RADIUS, GAP_ANGLE, -GAP_ANGLE); ctx.stroke();
    ctx.restore();

    balls.forEach(b => { b.update(); b.draw(); });
    requestAnimationFrame(render);
}

window.onload = () => { startLoop(); render(); };
</script>
</body>
</html>