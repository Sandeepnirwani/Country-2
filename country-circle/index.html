<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>100 COUNTRY PRO LOOP</title>
<style>
:root { --neon:#00f2ff; --gold:#ffcc00; }
body {
  margin:0; background:#020205; overflow:hidden;
  display:flex; justify-content:center; align-items:center;
  font-family:Segoe UI, sans-serif;
}
#stream {
  width:100vw; height:177.77vw;
  max-width:56.25vh; max-height:100vh;
  position:relative; background:black;
}
canvas { width:100%; height:100%; display:block; }
#winner {
  position:absolute; inset:0;
  display:none; align-items:center; justify-content:center;
  flex-direction:column;
  background:rgba(0,0,0,.9); z-index:20;
}
#winner img {
  width:220px; height:220px;
  border-radius:50%; border:8px solid white;
}
#winner h1 { color:var(--gold); font-size: 3rem; }
.live {
  position:absolute; top:20px; left:20px;
  background:red; padding:8px 14px;
  font-weight:900; color:white; border-radius: 4px;
}
#startOverlay {
  position: absolute; inset: 0; background: rgba(0,0,0,0.8);
  z-index: 100; display: flex; justify-content: center; align-items: center;
}
#startBtn {
  padding: 20px 40px; font-size: 24px; background: #28a745;
  color: white; border: none; border-radius: 50px; font-weight: bold;
}

/* Scorecard (top-right) */
#scorecard { position:absolute; top:18px; right:18px; background:rgba(0,0,0,0.5); color:white; padding:10px 14px; border-radius:8px; font-weight:700; text-align:center; z-index:15; }
#scorecard div { margin:6px 0; }
#scorecard .val { font-size:18px; color:var(--neon); }

/* Commentary (dynamic) and static comment line */
#commentary { position:absolute; left:50%; transform:translateX(-50%); bottom:120px; color:white; font-size:18px; background:rgba(0,0,0,0.45); padding:8px 14px; border-radius:20px; z-index:15; opacity:0; transition:opacity .25s; }
#commentLine { position:absolute; left:50%; transform:translateX(-50%); bottom:72px; color:#fff; font-size:16px; background:rgba(255,255,255,0.03); padding:6px 12px; border-radius:20px; z-index:15; font-weight:700; letter-spacing:0.5px; }

/* Ticker at the bottom */
#ticker { position:absolute; left:0; right:0; bottom:0; height:56px; background:rgba(0,0,0,0.6); display:flex; align-items:center; overflow:hidden; z-index:14; }
#tickerInner { display:flex; align-items:center; gap:24px; padding-left:24px; will-change:transform; }
.tick { display:flex; gap:8px; align-items:center; color:#fff; font-weight:700; }
.tick img { width:36px; height:24px; object-fit:cover; border-radius:4px; }

</style>
</head>
<body>

<div id="startOverlay">
    <button id="startBtn">TAP TO START STREAM</button>
</div>

<div id="stream">
  <div class="live">LIVE</div>
  <div id="scorecard">
    <div><div style="font-size:10px; opacity:.8">REMAINING</div><div id="remaining" class="val">100</div></div>
    <div><div style="font-size:10px; opacity:.8">ELIMINATED</div><div id="eliminated" class="val">0</div></div>
    <div><div style="font-size:10px; opacity:.8">TIME</div><div id="elapsed" class="val">00:00</div></div>
  </div>
  <canvas id="c" width="1080" height="1920"></canvas>
  <div id="commentary"></div>
  <div id="commentLine">Comment your country's name to win</div>
  <div id="ticker"><div id="tickerInner"></div></div>
  <div id="winner">
    <img id="winnerImg">
    <h1 id="winnerName"></h1>
  </div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const CENTER = { x:540, y:960 };
const RADIUS = 500;
const BALL_R = 25; // Slightly larger for mobile visibility
const TOTAL = 100;

let balls = [];
let running = false;
let slowMo = 1;
let announced3 = false;
let startTime = 0;
let audioCtx;

const arena = { gapStart:-0.25, gapEnd:0.25 };

function bloop() {
  if(!audioCtx) return;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.frequency.value=500;
  o.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+.08);
  g.gain.value=.1;
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.1);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.1);
}

function elimSound() {
  if(!audioCtx) return;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.frequency.value=180;
  o.frequency.exponentialRampToValueAtTime(60,audioCtx.currentTime+.25);
  g.gain.value=.2;
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.3);
}

let announcerVoice = null;
function chooseAnnouncerVoice(){
  const vs = speechSynthesis.getVoices();
  announcerVoice = vs.find(v=>/en-(US|GB)/.test(v.lang) && /Google|Alex|Samantha|Joanna|Matthew|Daniel/i.test(v.name)) || vs.find(v=>/en-/.test(v.lang)) || vs[0];
}
if(typeof speechSynthesis !== 'undefined'){
  if(speechSynthesis.onvoiceschanged!==undefined) speechSynthesis.onvoiceschanged = chooseAnnouncerVoice;
  chooseAnnouncerVoice();
}

function say(t){
  if(!running && !t.toLowerCase().includes("winner")) return;
  if(typeof speechSynthesis !== 'undefined'){
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(t);
    if(announcerVoice) u.voice = announcerVoice;
    u.pitch = 0.9; u.rate = 1.05; u.volume = 1.0;
    speechSynthesis.speak(u);
  }
  const comEl = document.getElementById('commentary');
  if(comEl){ comEl.textContent = t; comEl.style.opacity = 1; setTimeout(()=>{ comEl.style.opacity = 0; }, 3500); }
}

const countries = [
  {code: 'us', name: 'United States'},
  {code: 'in', name: 'India'},
  {code: 'br', name: 'Brazil'},
  {code: 'gb', name: 'United Kingdom'},
  {code: 'fr', name: 'France'},
  {code: 'de', name: 'Germany'},
  {code: 'jp', name: 'Japan'},
  {code: 'cn', name: 'China'},
  {code: 'ru', name: 'Russia'},
  {code: 'it', name: 'Italy'},
  {code: 'es', name: 'Spain'},
  {code: 'mx', name: 'Mexico'},
  {code: 'kr', name: 'South Korea'},
  {code: 'ca', name: 'Canada'},
  {code: 'au', name: 'Australia'}
];
const flags = [];
for (let i = 0; i < countries.length; i++) {
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = `https://flagcdn.com/w160/${countries[i].code}.png`;
  flags.push({ name: countries[i].name, img });
}

// Exited list for ticker and scoring
let exited = [];
let tickerOffset = 0, tickerSpeed = 0.6;
function handleExit(ball){
  exited.unshift({name:ball.item.name, img: ball.item.img.src, time: Date.now()});
  if(exited.length>50) exited.pop();
  updateTicker();
  updateScorecard();
  say(`${ball.item.name} has been eliminated`);
}
function updateTicker(){
  const inner = document.getElementById('tickerInner');
  if(!inner) return;
  inner.innerHTML = exited.map(e=>`<div class="tick"><img src="${e.img}" /><span>${e.name}</span></div>`).join('   ');
  tickerOffset = 0;
}
function updateScorecard(){
  const rem = document.getElementById('remaining');
  const elim = document.getElementById('eliminated');
  const elapsed = document.getElementById('elapsed');
  if(rem) rem.textContent = balls.filter(b=>!b.out).length;
  if(elim) elim.textContent = exited.length;
  if(elapsed && startTime) {
    const s = Math.floor((performance.now()-startTime)/1000);
    elapsed.textContent = `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  }
}


class Ball {
  constructor(item){
    const a=Math.random() * Math.PI * 2;
    const r=Math.random() * (RADIUS-60);
    this.x=CENTER.x+Math.cos(a)*r;
    this.y=CENTER.y+Math.sin(a)*r;
    this.vx=(Math.random()-.5)*12;
    this.vy=(Math.random()-.5)*12;
    this.r=BALL_R;
    this.item=item;
    this.out=false;
  }

  update(){
    const dx=this.x-CENTER.x;
    const dy=this.y-CENTER.y;
    const d=Math.hypot(dx,dy)||1;
    this.vx+=(-dy/d)*0.05;
    this.vy+=( dx/d)*0.05;
    this.x+=this.vx*slowMo;
    this.y+=this.vy*slowMo;

    if(d>RADIUS-this.r){
      const ang=Math.atan2(dy,dx);
      if(ang>arena.gapStart && ang<arena.gapEnd){
        if(this.protectedUntil && this.protectedUntil > performance.now()){
          // bounce while protected
          const nx=dx/d, ny=dy/d;
          const dot = (this.vx * nx) + (this.vy * ny);
          this.vx -= 2 * dot * nx;
          this.vy -= 2 * dot * ny;
          this.x=CENTER.x+nx*(RADIUS-this.r-1);
          this.y=CENTER.y+ny*(RADIUS-this.r-1);
          bloop();
        } else {
          this.out=true;
          elimSound();
          try{ handleExit(this); }catch(e){}
        }
      } else {
        const nx=dx/d, ny=dy/d;
        const dot = (this.vx * nx) + (this.vy * ny);
        this.vx -= 2 * dot * nx;
        this.vy -= 2 * dot * ny;
        this.x=CENTER.x+nx*(RADIUS-this.r-1);
        this.y=CENTER.y+ny*(RADIUS-this.r-1);
        bloop();
      }
    }
  }

  draw(){
    ctx.save();
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
    ctx.clip();
    if(this.item.img.complete) {
        ctx.drawImage(this.item.img,this.x-this.radius||this.x-this.r,this.y-this.r,this.r*2,this.r*2);
    } else {
        ctx.fillStyle="white"; ctx.fill();
    }
    ctx.restore();
  }
}

function collide(){
  for(let i=0;i<balls.length;i++){
    for(let j=i+1;j<balls.length;j++){
      const a=balls[i], b=balls[j];
      const dx=b.x-a.x, dy=b.y-a.y;
      const d=Math.hypot(dx,dy);
      const min=a.r+b.r;
      if(d<min && d>0){
        const nx=dx/d, ny=dy/d;
        const overlap=min-d;
        a.x-=nx*overlap*0.5; a.y-=ny*overlap*0.5;
        b.x+=nx*overlap*0.5; b.y+=ny*overlap*0.5;
        const dvx=b.vx-a.vx, dvy=b.vy-a.vy;
        const impact = (dvx*nx) + (dvy*ny);
        if(impact>0)continue;
        a.vx+=impact*nx; a.vy+=impact*ny;
        b.vx-=impact*nx; b.vy-=impact*ny;
        bloop();
      }
    }
  }
}

function start(){
  balls=[];
  exited = [];
  updateTicker();
  updateScorecard();
  announced3=false;
  slowMo=1;
  arena.gapStart=-0.25;
  arena.gapEnd=0.25;
  startTime=performance.now();
  running=true;
  for(let i=0;i<TOTAL;i++) balls.push(new Ball(flags[i%flags.length]));
  say("And they're off! The race begins!");
}



function win(ball){
  running=false;
  document.getElementById("winnerImg").src=ball.item.img.src;
  document.getElementById("winnerName").textContent=ball.item.name+" WINS";
  document.getElementById("winner").style.display="flex";
  say(`And the winner is... ${ball.item.name}! What a performance!`);
  updateScorecard();
  setTimeout(()=>{
    document.getElementById("winner").style.display="none";
    start();
  },5000);
}

function loop(t){
  ctx.clearRect(0,0,1080,1920);
  if(running){
    if(t-startTime>15000){
      arena.gapStart-=0.0015;
      arena.gapEnd+=0.0015;
    }
    balls.forEach(b=>b.update());
    collide();
    balls=balls.filter(b=>!b.out);
    if(balls.length===3 && !announced3){
      announced3=true;
      slowMo=0.4;
      say("Only three remain");
    }
    if(balls.length===1) win(balls[0]);
  }
  
  ctx.strokeStyle="#00f2ff";
  ctx.lineWidth=20;
  ctx.beginPath();
  ctx.arc(CENTER.x,CENTER.y,RADIUS,arena.gapEnd,arena.gapStart);
  ctx.stroke();
  
  balls.forEach(b=>b.draw());

  // ticker scrolling
  const tickerInner = document.getElementById('tickerInner');
  if(tickerInner && tickerInner.scrollWidth > 0){
    tickerOffset += tickerSpeed;
    tickerInner.style.transform = `translateX(${-tickerOffset}px)`;
    if(tickerOffset > tickerInner.scrollWidth/2) tickerOffset = 0;
  }
  updateScorecard();

  requestAnimationFrame(loop);
}

document.getElementById("startBtn").onclick = () => {
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    document.getElementById("startOverlay").style.display = "none";
    start();
};

requestAnimationFrame(loop);
</script>
</body>
</html>